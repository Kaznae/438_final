pico-8 cartridge // http://www.pico-8.com
version 18
__lua__
function _init()
	
	bnp = false
	
	ticker = 0
	friction = .85
	gravity = 0.3

	sprites = {
		standing = 1,
		running = 3,
		falling = 17
	}
	
	player = {
		x = 8,
		y = 104,
		w = 8,
		h = 8,
		dx = 0,
		dy = 0,
		max_dy = 3,
		sprite = sprites.standing,
		on_ground = false,
		face_r = true
		}
end

function _draw()
	--rectfill(0,0,128,128,0)
	cls()
	
	--palt(0,false)
	
	rectfill(0,0,128,128,1)
	
	map(0,0,0,0,16,16)
	
	spr(player.sprite,player.x,player.y,1,1,player.face_r)
	
end

function sprite_update()
	ticker += 1
	
	if abs(player.dy) > 0 then
		player.sprite = sprites.falling
	else
		
		if abs(player.dx) > 0 then
			player.sprite = sprites.running
			if player.dx < 0 then
				player.face_r = true
			else
				player.face_r = false
			end
		else
			player.sprite = sprites.standing
		end
		
		if ticker > 10 then
			if ticker < 20 then
				player.sprite += 1
			else
				ticker = 0
			end
		end
		
	end
end

function physics_update()
	player.dx *= friction
	if not on_ground then
		player.dy += gravity
		if player.dy > player.max_dy then
			player.dy = player.max_dy
		end
	end
	
	if check_collision(player,"x") then
		player.x += player.dx
	end
	if check_collision(player,"y") then
		player.y += player.dy
	else
		if player.dy > 0 then
			player.dy = 0
			on_ground = true
		else
			player.dy = 0
			on_ground = false
		end
	end
	
	if abs(player.dx) < 0.05 then
		player.dx = 0
	end
	
end

function check_collision(obj,direction)
	local x = obj.x local y = obj.y
	
	if direction == "x" then
		if player.dx > 0 then
			checkx = x + 1
		else
			checkx = x - 1
		end
		checky = y
	else
		checkx = x
		if player.dy > 0 then
			checky = y + 1
		else
			checky = y - 1
		end
	end
	
	if player.dx > 0 then
		checkx += obj.w
	end
	
	if player.dy > 0 then
		checky += obj.h
	end
	
	if fget(mget(checkx/8,checky/8),0) then
		return false
	else
		return true
	end
end

function _update()
	

	if btn(0) then
		if btn(5) then
			player.dx-=.3
		end
		player.dx-=.3
	end
	if btn(1) then
		if btn(5) then
			player.dx+=.3
		end
		player.dx +=.3
	end
	if btnp(2) then
		if on_ground then
			on_ground = false
			player.dy = -3
		end
	end
	
	physics_update()
	sprite_update()
	
end
__gfx__
00000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000cc000000000000000ccc000c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0070070000cccc00000cc000000cccccc000ccc00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000770000cccccc000cccc0000cc8ccc000ccccc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000cc8cc8cc0cccccc00ccccc8c00cc8ccc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700cccccccccc8cc8cc0ccccccc0ccccc8c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000cccccc0cccccccc0cccccc00ccccccc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000cccc000cccccc000cccc0000ccccc00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000cc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000cc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000cccc000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000cccc000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000c8cc8c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000cccccc00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000cccc000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000cccc000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44444444b33bbb3bb333bb3366666666000000005555555555555555008880000000000000000000000000000aaa000aa0000aa0000000000000000000000000
400000043bb33b3b3bbb333b6555555600000000555555555555555508888000000000000000000000000000000a00aaaa00a000000000000000000000000000
40444404b3b3b3b3333b33b36555555660066006dd5555dd5555555588a8800000000000000000000000000000000aaaaaa0000a000000000000000000000000
4040040444444444b333b3336556655650055005555665555555555588888000000000000000000000000000aa00aaaaaaaa00aa000000000000000000000000
4040040445455544bb3333b36556655655555555555665555555555500088000000000000000000000000000000aaaaaaaaaa000000000000000000000000000
404444044444454433bbbbb36555555655555555dd5555dd555555550008800000000000000000000000000000aaaaaaaaaaaa00000000000000000000000000
4000000444544545b333333365555556555555555555555555555555000880000000000000000000000000000aaaaaaaaaaaaaa0000000000000000000000000
44444444444444443b3bb3bb6666666655555555555555555555555500088000000000000000000000000000aaaaaaaaaaaaaaaa000000000000000000000000
4444444400000000000000000000000000000000000000000000000000000000000000000000000000000000aaaaaaaaaaaaaaaa000000000000000000000000
44444444000000000000000000000000000000000000000000000000000000000000000000000000000000000aaaaaaaaaaaaaa0000000000000000000000000
444444440000000000000000000000000000000000000000000000000000000000000000000000000000000000aaaaaaaaaaaa00000000000000000000000000
4444444400000000000000000000000000000000000000000000000000000000000000000000000000000000000aaaaaaaaaa000000000000000000000000000
4444444400000000000000000000000000000000000000000000000000000000000000000000000000000000aa00aaaaaaaa00aa000000000000000000000000
4444444400000000000000000000000000000000000000000000000000000000000000000000000000000000a0000aaaaaa00000000000000000000000000000
4444444400000000333333330000000000000000000000000000000000000000000000000000000000000000000a00aaaa00a000000000000000000000000000
4444444400000033333333333300000000000000000000000000000000000000000000000000000000000000000a000aa0000a00000000000000000000000000
0b0b0b0b000033333333333333330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
b3b3b3b3000333333333333333333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
33333333003333333333333333333300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
b3b3b3b3033333333333333333333330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bbbbbbbb033333333333333333333330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000003333333333333333333300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000333333333333333333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000033333333333333330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010101010101800000000000000000030000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000004b4c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000005b5c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5152525300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
6162626300000000000000000000514700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0050500000000000000000000000616200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0050500000606060606060606000005000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0050500000000000000000000000005000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0050500000000000000000000000005000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0060606060606060606060600000005000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000005000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000005000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4242424242424242424242424242424200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4141414141414141414141414141414100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4747474747474747474747474747474700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
