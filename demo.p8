pico-8 cartridge // http://www.pico-8.com
version 18
__lua__
--initial variables etc

function _init()
	
	bnp = false
	
	ticker = 0
	friction = .9
	gravity = 0.3

	sprites = {
		standing = 1,
		running = 3,
		falling = 17
	}
	
	plr = {
		x = 8,
		y = 104,
		w = 8,
		h = 8,
		dx = 0,
		dy = 0,
		max_dy = 3,
		sprite = sprites.standing,
		on_ground = true,
		face_r = true,
		j_left = 2,
		max_jump = 2
		}
end





-->8
--draw and update

function _draw()
	--rectfill(0,0,128,128,0)
	cls()
	
	--palt(0,false)
	
	rectfill(0,0,128,128,1)
	
	map(0,0,0,0,16,16)
	
	spr(plr.sprite,plr.x,plr.y,1,1,plr.face_r)
	
	print("dx:"..plr.dx.." dy:"..plr.dy,16,16,7)
	
end

function _update()
	

	if btn(0) then
		if btn(5) then
			plr.dx-=.2
		end
		plr.dx-=.2
	end
	if btn(1) then
		if btn(5) then
			plr.dx+=.2
		end
		plr.dx +=.2
	end
	if btnp(2) then
		if plr.j_left > 0 then
			plr.on_ground = false
			plr.j_left -= 1
			plr.dy = -3
		end
	end
	
	physics_update()
	sprite_update()
	
end
-->8
--collision checking and physics
function move()
	startx = plr.x
	starty = plr.y
	x_ofst = 0
	y_ofst = 0
	
	--attempt to change dy
	plr.dy+=gravity
	
	plr.x += plr.dx
	
	if plr.dx > 0 then
		x_ofst = 7
	end
	
	--get the object at center y, x + offset
	local obj_at = mget((plr.x+x_ofst)/8,(plr.y+4)/8)
	
	--if theres an object where this would move us
	--go back to where we started in terms of x
	if fget(obj_at,0) then
		if plr.dx > 0 then
			plr.x = flr((plr.x)/8)*8
		end
		
		plr.dx = 0
		if not plr.on_ground then
			if fget(obj_at,1) then
				plr.j_left += 1
			end
		end
		--will need code to deal with left collision
	end
	
	plr.y += plr.dy

	if plr.dy > 0 then
		y_ofst = 7
	end
	
	--get object at where we'd fall to, center of player
	obj_at = mget((plr.x+4)/8,(plr.y+y_ofst)/8)

	if fget(obj_at,0) then
		--gets the top of the object that we're hitting
		plr.y = flr(plr.y/8)*8
		
		--stops our movement
		plr.dy = 0
		--we're on the ground
		plr.on_ground = true
		if plr.j_left < plr.max_jump then
			plr.j_left = plr.max_jump
		end
	end
end

function physics_update()

	if plr.j_left > plr.max_jump then
		plr.j_left = plr.max_jump
	end

	plr.dx *= friction
	
	move()
	
	if abs(plr.dx) < 0.1 then
		plr.dx = 0
	end
	
end



-->8
--animation functions

function sprite_update()
	ticker += 0.5
	
	if not plr.on_ground then
		plr.sprite = sprites.falling
	else
		
		if abs(plr.dx) > 0 then
			plr.sprite = sprites.running
			if plr.dx < 0 then
				plr.face_r = true
			else
				plr.face_r = false
			end
		else
			plr.sprite = sprites.standing
		end
		
		if ticker > 10 then
			if ticker < 20 then
				plr.sprite += 1
			else
				ticker = 0
			end
		end
		
	end
end

__gfx__
00000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000cc000000000000000ccc000c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0070070000cccc00000cc000000cccccc000ccc00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000770000cccccc000cccc0000cc8ccc000ccccc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000cc8cc8cc0cccccc00ccccc8c00cc8ccc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700cccccccccc8cc8cc0ccccccc0ccccc8c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000cccccc0cccccccc0cccccc00ccccccc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000cccc000cccccc000cccc0000ccccc00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000cc000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000cc000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000cccc00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000cccc00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000c8cc8c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000cccccc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000cccc00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000cccc00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44444444b33bbb3bb333bb33666666660000000055555555555555550088800005b3000043344444b55544440aaa000aa0000aa0000000000000000000000000
400000043bb33b3b3bbb333b6555555600000000555555555555555508888000005b30004b344444bb355444000a00aaaa00a000000000000000000000000000
40444404b3b3b3b3333b33b36555555660066006dd5555dd5555555588a880000535b30043b444444bb3554400000aaaaaa0000a000000000000000000000000
4040040444444444b333b333655665565005500555566555555555558888800003bb300035444444444b3344aa00aaaaaaaa00aa000000000000000000000000
4040040445455544bb3333b3655665565555555555566555555555550008800005b3000043b44444444b3444000aaaaaaaaaa000000000000000000000000000
404444044444454433bbbbb36555555655555555dd5555dd555555550008800005b30000445b4444bbbb344400aaaaaaaaaaaa00000000000000000000000000
4000000444544545b333333365555556555555555555555555555555000880005b30000043b34443355b34440aaaaaaaaaaaaaa0000000000000000000000000
44444444444444443b3bb3bb6666666655555555555555555555555500088000b30000003334444b33353355aaaaaaaaaaaaaaaa000000000000000000000000
444444440000000000000000000000000000000000000000000000000000000053bb00003bb44bbb4435bb35aaaaaaaaaaaaaaaa000000000000000000000000
4444444400000000000000000000000000000000000000000000000000000000553b000033b4bb4444435b330aaaaaaaaaaaaaa0000000000000000000000000
4444444400000000000000000000000000000000000000000000000000000000053bb00055333bbb44433bb300aaaaaaaaaaaa00000000000000000000000000
44444444000000000000000000000000000000000000000000000000000000000553b0004555533bb444b4bb000aaaaaaaaaa000000000000000000000000000
44444444000000000000000000000000000000000000000000000000000000000053bb0044445553b4bb3444aa00aaaaaaaa00aa000000000000000000000000
444444440000000000000000000000000000000000000000000000000000000000553b0044444453bb333444a0000aaaaaa00000000000000000000000000000
44444444000000003333333300000000000000000000000000000000000000000053bb004444443344444444000a00aaaa00a000000000000000000000000000
4444444400000033333333333300000000000000000000000000000000000000053bb00044444433b4444444000a000aa0000a00000000000000000000000000
0b0b0b0b000033333333333333330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
b3b3b3b3000333333333333333333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
33333333003333333333333333333300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
b3b3b3b3033333333333333333333330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bbbbbbbb033333333333333333333330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000003333333333333333333300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000333333333333333333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000033333333333333330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010101010303800003030000000000030000000000000000030300000000000100000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000494a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000595a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
494a000000000000000000000000494a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
595a000000606060606060000000595a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
494a000000000000000000000000494a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
595a000000000000000000000000595a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
494a000000000000000000000000494a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
595a424242424242424242000000595a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000048000000480000000000494a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000058000000580000000000595a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4242424242424242424242424242424200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4141414141414141414141414141414100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4747474747474747474747474747474700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
